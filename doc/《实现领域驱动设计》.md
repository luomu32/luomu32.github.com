# 实现领域驱动设计

##领域、子域和界限上下文

##上下文映射图

## 架构

DDD模式适用于不同的各种架构。

分层架构？六边形架构？CQRS架构？事件驱动架构？

###分层架构

分层架构是非常简单的一种架构模式。广泛存在于Web应用，桌面应用和企业级应用当中。这一架构的核心理念就是将应用或系统拆分成不同的层级，来负责不同的内容。

比如在Web应用中，常见的MVC模式就是采用了分层架构。一般采用MVC模式的应用，会分为Controller层，Service层和DAO层。应用根据具体的业务，在分层上会进一步细化，甚至分到四层，五层。

分层架构又会分为：严格分层架构和松散分层架构。严格分层架构要求某层只能于下一层发生耦合。松散分层架构允许任意上层与任意下层发生耦合。许多系统采用的是松散分层架构。在观察者或调停者模式中，较低层可以耦合较高层，但是较低层绝不允许直接访问较高层。

用户界面（或Controller层）不应该包含业务领域或业务逻辑。该层中对用户参数的校验和领域层的校验是不同的。

###六边形架构

六边形架构也称为端口与适配器架构。

六边形架构可以和其他架构组合使用。

### 面向服务架构

### REST架构风格

首先说明下架构风格，架构风格之于架构就像设计模式之于设计一样。架构风格在于架构之下，对架构更细化，但在架构实现之上，对架构实现的抽象。

REST（Representational State Transfer），Roy T.Fielding的一篇博士论文对REST有很权威的诠释，中文称为[《架构风格与基于网络应用软件的架构设计》](https://yuedu.baidu.com/ebook/780324fbf121dd36a32d8269)。REST属于Web架构的一种架构风格。

很多人对REST有不同的理解，甚至是误解。在实际的使用当中，也没有严格按照REST的规范要求来实施。当然这也不是不可以，按照自己的理解和业务环境来使用某种技术。但当使用REST之后，并没有享受到对应的好处，可能需要更换成另一种分布式系统架构。就好像使用关系型数据库，我们也可以设计出一个大表，分键值两个字段，将随有数据都可以放入这个表中。但这么使用，就无法使用到关系型数据库的很多功能，比如查询、组合、排序等。

资源是在REST中一个关键的概念。通过HTTP的动词，可以对资源进行增删改查操作。GET表示获取，POST表示创建，PUT表示修改，DELETE表示删除。一般GET、PUT和DELETE是幂等的，可以安全的对失败的请求进行重试。

HATEOAS（Hypermedia as the Engine of Application State），简单讲各个资源相互链接，能通过一个资源链接访问到其他资源。对服务器来说，意味着返回结果中包含对其他资源的链接。

#### 与DDD集成

==不建议讲领域模型通过RESTful接口直接暴露出去==。有两种方式与DDD集成：

1. 为系统接口创建一个单独的界限上下文。此上下文通过合适的策略来访问核心模型。该上下文暴露的接口反应的是客户所需的用例，可以来自核心域的聚合。
2. 用于需要使用标准媒体类型的时候。创建一个领域模型来处理每一种媒体类型。

### CQRS（命令和查询职责分离）

资源库提供的查询往往无法满足复杂的查询需求。所以需要从不同的资源库中获取聚合实例，然后再将这些实例组装成一个DTO（数据传输对象）；或者在一个查询中使用特殊的查询方法将不同的资源库的数据组合在一起。这时候可以使用CQRS来解决这个问题。

CQRS指导原则：

1. 如果一个方法修改了对象状体，该方法就是一个命令，它不应该返回数据。
2. 如果一个方法返回了数据，该方法就是一个查询，它不应该通过直接或间接的手段修改对象的状态。

#### 与DDD集成

分为两个模型，一个只包含查询的称之为查询模型或读模型，另一个排除查询的称之为命令模型或写模型。

## 聚合



