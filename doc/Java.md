# Java

##虚拟机

- 本地方法区
- 程序计数器
- 堆
- 栈
- 运行时常量池

###内存回收算法

###内存回收机制

## 问题分析及工具

Java默认提供了很多工具。

- Jhat。分析堆转储文件：headdump。jhat指定一个文件，进行分析，然后在本地起一个web服务用于查看分析结果。默认端口是8080，冲突可以使用port参数修改端口。分析结果列出堆中的所有类，不直观，不容易分析出问题。
- jmap
- jvisual。集大成的分析工具，图形化，方便使用。

### 分析方法

一般是有问题才会去分析。主要是这么几个场景：

1. 性能调优，碰到了死锁，活锁等多线程问题
2. 发生了OOM，内存溢出

第一种一般是疑似，然后使用工具去连接应用然后分析，确认和定位问题。第二种一般是在应用启动时，设置启动参数，当发生了内存溢出，奔溃等问题时，由虚拟机自动生成转储文件。然后使用工具去分析转储文件。

## 多线程



## IO

`File`对象通常表示文件系统中的一个文件。通过构造该对象可以对文件系统中的文件进行读写操作。

`Path`对象是Java 7新增的。方便获取路径。`Paths.get('/dev','local','tex.dl')`，也可以是相对路径`Paths.get('tex.d')`。也可以是URI。`Paths.get(new URI(""))`。可以通过File来获取，`new File('').toPath()`。通过Path还可以注册监听器，监听文件的变化。

`Files`。文件操作工具类，提供文件复制、移动、删除等等功能。

- 写入，write。可以指定StandardOpenOption写入模式，新建或是追加，或者文件已存在返回失败等
- 创建文件。createFile
- 创建目录，createDirectory及createDirectories

## 安全

### 类的加载机制

一个类加载器在加载的时候会先委托父加载器去加载，父加载器会委托给它的父加载器去尝试加载。一直到引导类 加载器，该加载器没有父加载器。引导类加载器专用于加载`rt.jar`中Java的类。这种设计方式是为了安全，防止加载不安全的核心类。

### 安全管理器

当一个类被加载到虚拟机中，通过检查之后，会交由安全管理器检查。默认是不安装安全管理器，所有的操作都将被允许。

### 消息摘要

Message Digest。数据块的数字指纹。可用于数据的完整性校验，防篡改。SHA（安全散列算法）或MD5来生成，MD5的安全性不够高，不推荐使用。

Java提供`MessageDigest`。

### 消息签名

光有消息摘要还是无法完全解决被篡改的问题。如果消息和对应的摘要都被截取了，修改消息后只要再生成一次新的摘要即可，消息接收方收到的被修改后的消息及修改后的消息摘要，无法判断出消息是否被篡改了。

消息签名基于非对称加密。

#### 过程

1. 生成公钥和私钥。
2. 将公钥发布出去，给消息接收者
3. 将消息摘要（如果是完整消息计算量过大）通过私钥进行签名。
4. 消息接收到消息和签名，使用公钥对签名进行验证。如果验证通过，表示消息未被篡改，并消息的来源是指定来源，而不是篡改者。

JDK提供了keytool命令行工具用来管理生成证书。

- keystore。密钥库，是一个文件。用于保存密钥、公钥和证书。再创建或导入等操作时，不指定密钥库，默认采用用户home目录.keystore，没有自动创建。通过命令`keytool -list -rfc -keystore .keystore`可以查看密钥库中的内容。

证书格式：PKCS12（pfx）、cert

### 加密

`Ciper`类用于构造基于各种加密算法的实现类。`Cipher cipher=Cipher.getInstance("algorithName")`。

算法名称可以是：

- DES。不安全，可以被穷枚举。替代者：AES。

模式：warp和unwarp，使用另一个密钥来加密。

填充的问题。比如DES是8字节为单位，如果被加密的数据最后不足8字节，需要填充。

如果使用对称密码，密钥的安全分发是个难题，如果使用非对称加密，则操作速度慢很多。所以一般，采用非对称加密方式对对称密码的密钥进行加密分发，后续通信采用对称密码进行加密。