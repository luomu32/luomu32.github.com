# 编译原理

## 程序设计语言

1. 机器语言
2. 汇编语言
3. 高级程序设计语言

### 机器语言

能被计算值直接理解的语言称之为机器语言。用1和0表示的指令序列的集合。

### 汇编语言

用一系列助记符来表示指令中的操作和操作数，用符号表示程序用到的一系列数据。

汇编语言编写的程序高度依赖具体的计算机的型号。

### 高级语言

高级语言更倾向于人类的思维方式，大大提高了程序设计的效率。一条语句通常需要若干条机器指令去实现。

### 翻译

汇编语言和高级语言并不能直接被计算机执行，需要一个翻译的过程。

翻译分为两类：

- 将源程序完整地转换成机器语言或汇编语言，编译
- 不断地读取源程序中的语句，每次进行解释，同时读取所需要的数据，执行之后再根据执行结果读取下一条语句，再解释并执行，解释

编译的语言，编译的出的目标语言更好，执行效率也更高。

## 编译总体流程

```flow
st=>start: 源程序
la=>operation: 词法分析器
sa=>operation: 语法分析器
saic=>operation: 语义分析和中间代码生成器
op=>operation: 代码优化器
target=>operation: 目标代码生成器

st->la->sa->saic->op->target
```

整个流程的两端还辅以**符号管理器**和**出错处理器**。

### 词法分析（lexical analysis）

输入是组成源程序的字符串。剔除多余的空白符、注解等，切分出一个个记号（token），并请求符号管理器将这些记号登记到符号表中。记号又称为单词（word）。这个阶段出现的错误称为词法错误。

输出是二元组序列，一般形式为：（种别码，属性值）。

### 语法分析（syntax analysis or parsing）

程序编译的核心模块。

输入是词法分析器的输出。

语法具有层次结构，通常呈现树状结构，称之为语法树（syntax tree）。

### 语义分析（semantic analysis）

输入是语法分析的语法，分析其语义。

语义分析通常以中间代码的形式表达相应的操作过程。

使用中间代码是为了屏蔽具体计算机型号的细节，使得分析的结果不受机器的约束，增强移植性，利于代码的优化。

中间代码有以下几种表示：

- 波兰表示
- 三元式
- 四元式
- 树

### 代码优化

对中间代码进行优化处理，节省存储空间，有效利用机器资源。

分为**与机器有关优化**和**与机器无关优化**。

与机器无关的优化又分为局部优化和全局优化。局部优化有常量的合并、基本块内公共子表达式的提取。全局优化主要是指循环优化。

而与机器有关的优化主要涉及更有效地利用机器的具体资源。

优化在编译程序设计中难度较大的一部分，而且也非常耗时。

### 目标代码生成

完成从中间代码到目标机器上的机器指令或汇编代码的转换。如果生成的是机器指令代码，必须是可重定位（能使地址平移的代码。由于操作系统给程序分配的内存地址起始位置不定，所以需要修正程序中的地址）。

### 错误处理

发现错误后，尽量缩小错误的影响范围称之为错误的局部化（localization），保证编译程序能够继续完成对剩余部分的分析处理称之为续编译（compiling continuation）。

编译程序不仅要及时发现错误，准确定位，还能及时地、以恰当的方式通知用户，甚至还能纠正错误。

在以上几个模块中会有可能出现错误，所以错误处理是一个辅助模块，为其他模块提供服务。

### 符号表管理

也是一个辅助模块。

对在词法分析中发现的符号进行管理，方便后续如在目标代码生成时为其分配存储单元等时提供服务。

以不同的类型组织符号表，以合适的方式查、填、维护这些表格，提供服务。

## 编译程序

- 正确性
- 完备性
- 可维护
- 可移植

为了提升编译程序的可移植性，会将编译程序分为前端和后端。前端负责与机器无关的部分，后端负责与机器有管的部分。当需要移植到其他计算平台时，只要选一个合适的后端来配合前端即可。

